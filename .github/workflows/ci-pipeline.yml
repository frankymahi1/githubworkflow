
 # .github/workflows/python-app.yml

 name: Python application

 on:
    push:
      branches: [ main, github_test_branch ]
    pull_request:
      branches: [ main, github_test_branch ]
    workflow_dispatch:  # Allows manual triggering of the workflow

 jobs:
   test_data_generation:
     runs-on: ubuntu-latest

     steps:
     - name: Checkout repository
       uses: actions/checkout@v2

     - name: Set up Python
       uses: actions/setup-python@v2
       with:
         python-version: '3.x'

     - name: Install dependencies
       run: |
         python -m pip install --upgrade pip
         pip install -r requirements.txt

   build:
     needs: test_data_generation
     runs-on: ubuntu-latest

     steps:
     - uses: actions/checkout@v2

     - name: Set up Python
       uses: actions/setup-python@v2
       with:
         python-version: '3.x'

     - name: Install dependencies
       run: |
         python -m pip install --upgrade pip
         pip install -r requirements.txt

     - name: Run tests
       run: |
         pytest

   run_test_cases:
     ##if: github.event_name == 'workflow_dispatch'  # Only run if manually triggered
     runs-on: ubuntu-latest
     needs: build  # This line makes run_test_cases dependent on build
     strategy:
       matrix:
         job: [ virtual_dataset_registration, physical_dataset_registration, task_flow_execution, schema_registation, databricks_notebook ]


     steps:
     - uses: actions/checkout@v2

     - name: Set up Python
       uses: actions/setup-python@v2
       with:
         python-version: '3.x'

     - name: Install dependencies
       run: |
         python -m pip install --upgrade pip
         pip install -r requirements.txt

     - name: Print GitHub Event Name
       run: |
        echo "GitHub Event Name: ${{ github.event_name }}"
     - name: Execute specific script
        echo "Running script for ${{ matrix.job }}"
       run: |
          if [ "${{ matrix.job }}" == "virtual_dataset_registration" ]; then
            python test/data_registration.py
          elif [ "${{ matrix.job }}" == "physical_dataset_registration" ]; then
            python test/data_registration.py
          elif [ "${{ matrix.job }}" == "task_flow_execution" ]; then
            python test/data_registration.py
          elif [ "${{ matrix.job }}" == "schema_registration" ]; then
            python test/data_registration.py
          elif [ "${{ matrix.job }}" == "databricks_notebook" ]; then
            python test/data_registration.py
          fi

#     - name: Step 1 - Execute data Registration
#       run: python test/data_registration.py
#
#     - name: Step 2 - Execute schema Registration
#       run: python test/schema_registration.py
#     - name: Step 3 - Test calculator functionality
#       env:
#         PYTHONPATH: ./src
#       run: python test/test_calculator.py
   Reporting:
     runs-on: ubuntu-latest
     needs: run_test_cases
     steps:
     - uses: actions/checkout@v2

     - name: Set up Python
       uses: actions/setup-python@v2
       with:
         python-version: '3.x'
   dataset_registation:
     runs-on: ubuntu-latest
     needs: run_test_cases
     steps:
     - uses: actions/checkout@v2

     - name: Set up Python
       uses: actions/setup-python@v2
       with:
         python-version: '3.x'
   schema_registation:
     runs-on: ubuntu-latest
     needs: run_test_cases
     steps:
       - uses: actions/checkout@v2

       - name: Set up Python
         uses: actions/setup-python@v2
         with:
           python-version: '3.x'